!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CanvasUtils=e():t.CanvasUtils=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"degToRad",function(){return r}),n.d(o,"calcBoundingRect",function(){return i});const r=function(t){return Math.PI*t/180},i=function(t){const e={top:t.y,bottom:t.y+t.height,left:t.x,right:t.x+t.width};return Object.assign({},t,e)};var a={...o};class c{constructor(t,e){this.args={id:t,component:e},this.ctx=wx.createCanvasContext(t,e),this.DEFAULT_TEXT_CONFIG={fontSize:16,color:"#000",baseLine:"top",textAlign:"left",lineHeight:16,bold:!1,maxWidth:void 0,draw:!0,textIndent:0},this.config={CANVAS_HEIGHT:1750,CANVAS_WIDTH:1750,text:Object.assign({},this.DEFAULT_TEXT_CONFIG),coordinate:{gear:50,lineWidth:1,dashWidth:1,gapWidth:5}}}getContext(){return this.ctx}getCanvasId(){return this.args.id}getComponent(){return this.args.component}draw(t=!0){return new Promise(e=>{this.ctx.draw(t,()=>{e()})})}}let s,l,d;function h(t,e){return"right"===e?(t.x-=t.width,t):"center"===e?(t.x-=t.width/2,t):t}function u(t="",e=0,n=0,o=!0,r=0){const{lineHeight:i,fontSize:c,color:d,textAlign:h}=s.text,u=(i-c)/2;l.setFontSize(c),l.setFillStyle(d),l.setTextAlign(h),o&&l.fillText(t,e+u+r,n+u+-3);const g={x:e,y:n,width:l.measureText(""+t).width+r,height:i};return a.calcBoundingRect(g)}function g(t,e,n=!0){const{x:o,y:r,height:i}=e;return u(t,o,r+i,n)}function p(t){return/\n|\r/.test(t)}const f=function(t,e,n=0,o){return l.setFontSize(e),l.measureText(t+"").width+n>o};function x(t,e,n,o){s=this.config,d=this.DEFAULT_TEXT_CONFIG,l=this.getContext(),Object.assign(s.text,d,o);const{fontSize:r,baseLine:i,draw:c,lineLimit:x,textAlign:y,textIndent:b}=s.text;let{maxWidth:T,lineHeight:w}=s.text;if(T=T||s.CANVAS_WIDTH,w<r&&(w=r,s.text.lineHeight=r),l.setFontSize(r),l.setTextBaseline(i),f(t,r,b,T)||function(t){return/\n|\r/g.test(t)}(t)){let o={},i=0;for(let a=1;a<=t.length;a++){if(x>0&&i===x){t="";break}let s=t.substring(0,a);if(f(s,r,0===i?b:0,T)||p(s[s.length-1])){let r;p(s[s.length-1])?(r=s.slice(0,s.length-1),t=t.slice(s.length,t.length)):(r=s.slice(0,s.length-1),t=t.slice(r.length,t.length)),o=0===i?u(r,e,n,c,b):g(r,o,c),a=0,i++}}t&&(g(t,o,c),i++);let s={x:e,y:n,width:T,height:i*w};return s=h(s,y),a.calcBoundingRect(s)}{let o=u(t,e,n,c,b);return o=h(o,y),a.calcBoundingRect(o)}}const y=/^(linear-gradient)\((-?\d+deg,(#[0-9a-fA-F]{6} \d+%,?)+)\);?$/g;function b(t){const e=(t=t.replace(/, /g,",")).replace(y,"$1"),n=t.replace(y,"$2").split(",");let o=parseFloat(n[0]),r=[1,1];switch(o%360){case 0:r=r.concat([1,0]);break;case 90:r=r.concat([0,1]);break;case 180:r=r.concat([0,-1]);break;case 270:r=r.concat([-1,0]);break;default:r=r.concat([1,1/Math.tan(a.degToRad(o))])}let i=[];for(let t=1;t<n.length;t++){const e=n[t].split(" ");i.push([parseFloat(e[1])/100,e[0]])}return{type:e,factors:r,stops:i}}const T=/^(circular-gradient)\(((#[0-9a-fA-F]{6} \d+%,?)+)\);?$/g;function w(t){const e=(t=t.replace(/, /g,",")).replace(T,"$1"),n=t.replace(T,"$2").split(",");let o=[];for(let t=0;t<n.length;t++){const e=n[t].split(" ");o.push([parseFloat(e[1])/100,e[0]])}return{type:e,stops:o}}function C(t){const e=this.getCanvasId(),n=this.getComponent();return new Promise((o,r)=>{const{x:i,y:a,width:c,height:s}=t;wx.canvasGetImageData({canvasId:e,x:i,y:a,width:c,height:s,success:t=>o(t),fail:t=>r(t)},n)})}function m(t,e){const n=this.getCanvasId(),o=this.getComponent();return new Promise((r,i)=>{const{x:a,y:c,width:s,height:l}=e;wx.canvasPutImageData({canvasId:n,data:t,x:a,y:c,width:s,height:l,success:t=>r(t),fail:t=>i(t)},o)})}c.prototype.drawCoordinate=function(t){const e=this.config,n=this.getContext();Object.assign(e.coordinate,t);const{CANVAS_HEIGHT:o,CANVAS_WIDTH:r}=e,{gear:i,lineWidth:a,dashWidth:c,gapWidth:s}=e.coordinate,l=o/i;n.setLineWidth(a),n.setLineDash([c,s],0),n.setStrokeStyle("#CCC");for(let t=0;t<l;t++)n.beginPath(),n.moveTo(0,t*i),n.lineTo(r,t*i),n.stroke(),n.moveTo(t*i,0),n.lineTo(t*i,o),n.stroke(),n.closePath()},c.prototype.calcBoundingRect=a.calcBoundingRect,c.prototype.setText=x,c.prototype.calcTextBoundingRect=function(t,e,n,o){return x(t,e,n,{...o,draw:!1})},c.prototype.loadImages=function(t){const e=t.map(t=>new Promise((e,n)=>{wx.getImageInfo({src:t,success:t=>e(t),fail:t=>n(t)})}));return Promise.all(e)},c.prototype.drawImage=function(t,e,n,{mode:o="scaleToFill",width:r=t.width,height:i=t.height,borderRadius:c=0,borderWidth:s=0,borderColor:l="#000",draw:d=!0}={}){const h=this.getContext();let u=0,g=0,p=t.width,f=t.height;const x=r/p,y=i/f,b=x<y;let T=!/\.gif$/.test(t.path);switch(o){case"aspectFit":b?i=f*x:r=p*y;break;case"aspectFill":b?(u=(p-r/y)/2,p=r/y):(g=(f-i/x)/2,f=i/x);break;case"widthFix":i=f*x;break;case"center":u=(p-r)/2,g=(f-i)/2,p=r,f=i;break;case"top":u=(p-r)/2,p=r,f=i;break;case"bottom":u=(p-r)/2,g=f-i,p=r,f=i;break;case"left":g=(f-i)/2,p=r,f=i;break;case"right":u=p-r,g=(f-i)/2,p=r,f=i;break;case"none":T=!1}d&&(s>0&&this.fillRect(e-s,n-s,r+2*s,i+2*s,c+s,l),h.save(),this.createRectPath(e,n,r,i,c),h.clip(),T?h.drawImage(t.path,u,g,p,f,e,n,r,i):h.drawImage(t.path,e,n,r,i),h.restore());let w={x:e-s,y:n-s,width:r+2*s,height:i+2*s};return a.calcBoundingRect(w)},c.prototype.fillRect=function(t,e,n,o,r=0,i="#fff"){const c=this.getContext();this.createRectPath(t,e,n,o,r),this.isLinearGradientString(i)?c.setFillStyle(this.createLinearGradient(t,e,t+n,e+o,i)):this.isCircularGradientString(i)?c.setFillStyle(this.createCircularGradient(t+n/2,e+o/2,Math.max(n,o)/2,i)):c.setFillStyle(i),c.fill(),c.fillRect(0,0,0,0);let s={x:t,y:e,width:n,height:o};return a.calcBoundingRect(s)},c.prototype.strokeRect=function(t,e,n,o,r=0,i=0,c="#fff"){const s=this.getContext();for(let a=1;a<=i;a++){const i=a;this.createRectPath(t-i,e-i,n+2*i,o+2*i,r+i),s.setStrokeStyle(c),s.stroke()}s.fillRect(0,0,0,0);let l={x:t,y:e,width:n+2*i,height:o+2*i};return a.calcBoundingRect(l)},c.prototype.createRectPath=function(t,e,n,o,r){const i=this.getContext(),c={x:t,y:e},s={x:t+n,y:e},l={x:t+n,y:e+o},d={x:t,y:e+o};i.beginPath(),i.moveTo(c.x,c.y+r),i.arc(c.x+r,c.y+r,r,a.degToRad(180),a.degToRad(270)),i.lineTo(s.x-r,s.y),i.arc(s.x-r,s.y+r,r,a.degToRad(270),a.degToRad(360)),i.lineTo(l.x,l.y-r),i.arc(l.x-r,l.y-r,r,a.degToRad(0),a.degToRad(90)),i.lineTo(d.x+r,d.y),i.arc(d.x+r,d.y-r,r,a.degToRad(90),a.degToRad(180)),i.lineTo(c.x,c.y+r),i.closePath()},c.prototype.isLinearGradientString=function(t){return t=t.replace(/, /g,","),y.test(t)},c.prototype.parseLinearGradientString=b,c.prototype.createLinearGradient=function(t,e,n,o,r){const i=this.getContext(),a=b(r);console.log(t,e,t+Math.abs(n*a.factors[2]),e+Math.abs(o*a.factors[3]));const c=i.createLinearGradient(t,e,t+Math.abs(n*a.factors[2]),e+Math.abs(o*a.factors[3])),s=a.stops;return console.log(s),s.forEach(t=>{c.addColorStop(t[0],t[1])}),c},c.prototype.isCircularGradientString=function(t){return t=t.replace(/, /g,","),T.test(t)},c.prototype.parseCircularGradientString=w,c.prototype.createCircularGradient=function(t,e,n,o){const r=this.getContext(),i=w(o).stops,a=r.createCircularGradient(t,e,n);return i.forEach(t=>{a.addColorStop(t[0],t[1])}),a},c.prototype.copyPixel=C,c.prototype.copy=C,c.prototype.pastePixel=m,c.prototype.paste=m;e.default=c}])});
//# sourceMappingURL=canvas-utils.js.map